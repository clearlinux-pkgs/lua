Patch obtained from lua-l mailing list:

http://lua.2524044.n2.nabble.com/Bug-Report-Use-after-free-in-debug-upvaluejoin-tc7685506.html

--- lua-5.3.5/src/lapi.c        2017-12-06 18:35:12.000000000 +0000
+++ lua-patched/src/lapi.c      2019-01-23 23:36:46.694067402 +0000
@@ -1289,11 +1289,11 @@
   LClosure *f1;
   UpVal **up1 = getupvalref(L, fidx1, n1, &f1);
   UpVal **up2 = getupvalref(L, fidx2, n2, NULL);
-  luaC_upvdeccount(L, *up1);
-  *up1 = *up2;
-  (*up1)->refcount++;
-  if (upisopen(*up1)) (*up1)->u.open.touched = 1;
-  luaC_upvalbarrier(L, *up1);
+  if(*up1 != *up2) {
+    luaC_upvdeccount(L, *up1);
+    *up1 = *up2;
+    (*up1)->refcount++;
+    if (upisopen(*up1)) (*up1)->u.open.touched = 1;
+    luaC_upvalbarrier(L, *up1);
+  }
 }
-
-
